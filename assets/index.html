<!doctype html>
<head>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/grid.css">
    <link rel="stylesheet" href="/static/css/elm.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <audio src="/static/audio/soaring.mp3" autoplay="true" loop="true"></audio>
    <script src="/static/main.js"></script>
    <script>
        var app = Elm.Main.fullscreen()

        app.ports.readToken.subscribe(function() {
            let user = {};
            let valid = true;
            ['token', 'id', 'podId'].forEach((key) => {
                let val = localStorage.getItem(key);
                if (val !== null) {
                    user[key] = val;
                } else {
                    valid = false;
                }
            });
            if (valid) {
                app.ports.receiveToken.send(user);
            }
        });

        app.ports.saveToken.subscribe(function({token, id, podId}) {
            localStorage.setItem('token', token);
            localStorage.setItem('id', id);
            localStorage.setItem('podId', podId);
        });
    </script>
</body>
